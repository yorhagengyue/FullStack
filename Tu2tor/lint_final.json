[{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\config\\database.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\controllers\\authController.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\controllers\\bookingController.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\controllers\\reviewController.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'Tutor' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"Tutor"},"fix":{"range":[93,104],"text":""},"desc":"Remove unused variable 'Tutor'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":12,"suggestions":[{"messageId":"removeVar","data":{"varName":"User"},"fix":{"range":[133,143],"text":""},"desc":"Remove unused variable 'User'."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Review from '../models/Review.js';\nimport Booking from '../models/Booking.js';\nimport Tutor from '../models/Tutor.js';\nimport User from '../models/User.js';\n\n// @desc    Create a new review\n// @route   POST /api/reviews\n// @access  Private (Student only)\nexport const createReview = async (req, res) => {\n  try {\n    const { bookingId, tutorId, rating, comment, tags, isAnonymous } = req.body;\n\n    // Validation\n    if (!bookingId || !tutorId || !rating || !comment) {\n      return res.status(400).json({ message: 'Please provide all required fields' });\n    }\n\n    if (rating < 1 || rating > 5) {\n      return res.status(400).json({ message: 'Rating must be between 1 and 5' });\n    }\n\n    if (comment.length < 10) {\n      return res.status(400).json({ message: 'Comment must be at least 10 characters' });\n    }\n\n    // Check if booking exists and is completed\n    const booking = await Booking.findById(bookingId);\n    if (!booking) {\n      return res.status(404).json({ message: 'Booking not found' });\n    }\n\n    if (booking.status !== 'completed') {\n      return res.status(400).json({ message: 'Can only review completed sessions' });\n    }\n\n    // Verify user is the student of this booking\n    if (booking.studentId.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ message: 'You can only review your own bookings' });\n    }\n\n    // Check if review already exists\n    const existingReview = await Review.findOne({ bookingId });\n    if (existingReview) {\n      return res.status(400).json({ message: 'You have already reviewed this session' });\n    }\n\n    // Create review\n    const review = await Review.create({\n      bookingId,\n      tutorId,\n      studentId: req.user._id,\n      rating,\n      comment,\n      tags: tags || [],\n      isAnonymous: isAnonymous || false,\n      isVerified: true,\n    });\n\n    // Populate student info (if not anonymous)\n    await review.populate('studentId', 'username profilePicture');\n    await review.populate('tutorId', 'username');\n\n    res.status(201).json(review);\n  } catch (error) {\n    console.error('Create review error:', error);\n    res.status(500).json({ message: error.message || 'Error creating review' });\n  }\n};\n\n// @desc    Get all reviews for a tutor\n// @route   GET /api/reviews/tutor/:tutorId\n// @access  Public\nexport const getTutorReviews = async (req, res) => {\n  try {\n    const { tutorId } = req.params;\n    const { page = 1, limit = 10, sort = '-createdAt' } = req.query;\n\n    const reviews = await Review.find({ tutorId, isVerified: true })\n      .populate('studentId', 'username profilePicture')\n      .populate('bookingId', 'subject date')\n      .sort(sort)\n      .limit(limit * 1)\n      .skip((page - 1) * limit);\n\n    const total = await Review.countDocuments({ tutorId, isVerified: true });\n\n    // Get rating breakdown\n    const ratingBreakdown = await Review.getTutorRatingBreakdown(tutorId);\n\n    // Get average rating\n    const stats = await Review.getAverageRatingForTutor(tutorId);\n\n    res.json({\n      reviews,\n      stats: {\n        ...stats,\n        ratingBreakdown,\n      },\n      pagination: {\n        page: parseInt(page),\n        limit: parseInt(limit),\n        total,\n        pages: Math.ceil(total / limit),\n      },\n    });\n  } catch (error) {\n    console.error('Get tutor reviews error:', error);\n    res.status(500).json({ message: 'Error fetching reviews' });\n  }\n};\n\n// @desc    Get review for a specific booking\n// @route   GET /api/reviews/booking/:bookingId\n// @access  Private\nexport const getBookingReview = async (req, res) => {\n  try {\n    const { bookingId } = req.params;\n\n    const review = await Review.findOne({ bookingId })\n      .populate('studentId', 'username profilePicture')\n      .populate('tutorId', 'username');\n\n    if (!review) {\n      return res.status(404).json({ message: 'Review not found' });\n    }\n\n    res.json(review);\n  } catch (error) {\n    console.error('Get booking review error:', error);\n    res.status(500).json({ message: 'Error fetching review' });\n  }\n};\n\n// @desc    Get all reviews by a student\n// @route   GET /api/reviews/student/:studentId\n// @access  Private\nexport const getStudentReviews = async (req, res) => {\n  try {\n    const { studentId } = req.params;\n\n    // Verify user can access these reviews\n    if (req.user._id.toString() !== studentId && req.user.role !== 'admin') {\n      return res.status(403).json({ message: 'Not authorized to access these reviews' });\n    }\n\n    const reviews = await Review.find({ studentId })\n      .populate('tutorId', 'username profilePicture')\n      .populate('bookingId', 'subject date')\n      .sort('-createdAt');\n\n    res.json(reviews);\n  } catch (error) {\n    console.error('Get student reviews error:', error);\n    res.status(500).json({ message: 'Error fetching reviews' });\n  }\n};\n\n// @desc    Update a review\n// @route   PUT /api/reviews/:id\n// @access  Private (Review author only)\nexport const updateReview = async (req, res) => {\n  try {\n    const { id } = req.params;\n    const { rating, comment, tags, isAnonymous } = req.body;\n\n    const review = await Review.findById(id);\n\n    if (!review) {\n      return res.status(404).json({ message: 'Review not found' });\n    }\n\n    // Verify user is the author\n    if (review.studentId.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ message: 'You can only update your own reviews' });\n    }\n\n    // Update fields\n    if (rating !== undefined) {\n      if (rating < 1 || rating > 5) {\n        return res.status(400).json({ message: 'Rating must be between 1 and 5' });\n      }\n      review.rating = rating;\n    }\n\n    if (comment !== undefined) {\n      if (comment.length < 10) {\n        return res.status(400).json({ message: 'Comment must be at least 10 characters' });\n      }\n      review.comment = comment;\n    }\n\n    if (tags !== undefined) review.tags = tags;\n    if (isAnonymous !== undefined) review.isAnonymous = isAnonymous;\n\n    await review.save();\n\n    await review.populate('studentId', 'username profilePicture');\n    await review.populate('tutorId', 'username');\n\n    res.json(review);\n  } catch (error) {\n    console.error('Update review error:', error);\n    res.status(500).json({ message: 'Error updating review' });\n  }\n};\n\n// @desc    Delete a review\n// @route   DELETE /api/reviews/:id\n// @access  Private (Admin only)\nexport const deleteReview = async (req, res) => {\n  try {\n    const { id } = req.params;\n\n    const review = await Review.findById(id);\n\n    if (!review) {\n      return res.status(404).json({ message: 'Review not found' });\n    }\n\n    // Only admin can delete\n    if (req.user.role !== 'admin') {\n      return res.status(403).json({ message: 'Only admins can delete reviews' });\n    }\n\n    await Review.findByIdAndDelete(id);\n\n    res.json({ message: 'Review deleted successfully' });\n  } catch (error) {\n    console.error('Delete review error:', error);\n    res.status(500).json({ message: 'Error deleting review' });\n  }\n};\n\n// @desc    Mark review as helpful\n// @route   POST /api/reviews/:id/helpful\n// @access  Private\nexport const markReviewAsHelpful = async (req, res) => {\n  try {\n    const { id } = req.params;\n\n    const review = await Review.findById(id);\n\n    if (!review) {\n      return res.status(404).json({ message: 'Review not found' });\n    }\n\n    await review.markAsHelpful();\n\n    res.json({ message: 'Marked as helpful', helpfulCount: review.helpfulCount });\n  } catch (error) {\n    console.error('Mark helpful error:', error);\n    res.status(500).json({ message: 'Error marking review as helpful' });\n  }\n};\n\n// @desc    Tutor response to review\n// @route   POST /api/reviews/:id/response\n// @access  Private (Tutor only)\nexport const addTutorResponse = async (req, res) => {\n  try {\n    const { id } = req.params;\n    const { response } = req.body;\n\n    if (!response || response.length < 10) {\n      return res.status(400).json({ message: 'Response must be at least 10 characters' });\n    }\n\n    if (response.length > 500) {\n      return res.status(400).json({ message: 'Response must be less than 500 characters' });\n    }\n\n    const review = await Review.findById(id);\n\n    if (!review) {\n      return res.status(404).json({ message: 'Review not found' });\n    }\n\n    // Verify user is the tutor\n    if (review.tutorId.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ message: 'You can only respond to your own reviews' });\n    }\n\n    review.tutorResponse = response;\n    review.tutorResponseDate = new Date();\n\n    await review.save();\n\n    res.json(review);\n  } catch (error) {\n    console.error('Add tutor response error:', error);\n    res.status(500).json({ message: 'Error adding tutor response' });\n  }\n};\n\nexport default {\n  createReview,\n  getTutorReviews,\n  getBookingReview,\n  getStudentReviews,\n  updateReview,\n  deleteReview,\n  markReviewAsHelpful,\n  addTutorResponse,\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\controllers\\tutorController.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\middleware\\auth.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\models\\Booking.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\models\\Review.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\models\\Tutor.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\models\\User.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\routes\\authRoutes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\routes\\bookingRoutes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\routes\\reviewRoutes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\routes\\testRoutes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\routes\\tutorRoutes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\scripts\\seed.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\server.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gengy\\Desktop\\瀛︿範璧勬枡\\TP year2.2\\Full stack\\Tu2tor\\server\\src\\services\\codeExecution.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]

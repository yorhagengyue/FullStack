---
description: AI rules derived by SpecStory from the project AI interaction history
globs: *
---

## Headers

## PROJECT DOCUMENTATION & CONTEXT SYSTEM

This section contains the project's documentation, requirements, status, and any relevant context needed for development.

The "Tu2tor" project is a full-stack web application designed as a peer-to-peer tutor finder system for students. It uses the MERN stack (MongoDB, Express.js, React.js, Node.js) and includes advanced features like AI integration and real-time collaboration.

### **Project Structure & Tech Stack**

*   **Frontend (`Tu2tor/src`):**
    *   **Framework:** React with Vite.
    *   **Styling:** Tailwind CSS.
    *   **Key Pages:**
        *   Auth: Login/Register (`src/pages/Auth`).
        *   Dashboard: User overview (`src/pages/Dashboard`).
        *   Search: "Smart Matching" for tutors (`src/pages/Search`).
        *   Sessions: Real-time tutoring rooms with video and code collaboration (`src/pages/Sessions`).
        *   AI Chat: AI assistant interface (`src/pages/AIChat`).
        *   Landing: Public homepage (`src/pages/Landing/components/LandingPage.jsx`).
        *   Calendar: Interactive calendar for scheduling (`src/pages/Calendar/CalendarPage.jsx`).
        *   Todo: Task management and upcoming sessions (`src/pages/Todo/TodoPage.jsx`).
        *   StudyNotes: Saved learning materials and conversations (`src/pages/StudyNotes/StudyNotesPage.jsx`).
        *   KnowledgeBaseUpload: Page for uploading materials to Knowledge Base (`src/pages/KnowledgeBase/KnowledgeBaseUpload.jsx`).
    *   **Components (Landing Page):**
        *   Hero: (`src/pages/Landing/components/Hero.jsx`)
        *   Features: (`src/pages/Landing/components/Features.jsx`)
        *   HowItWorks: (`src/pages/Landing/components/HowItWorks.jsx`)
        *   FeaturesGrid: (`src/pages/Landing/components/FeaturesGrid.jsx`)
        *   Testimonials: (`src/pages/Testimonials.jsx`)
        *   CTA: (`src/pages/CTA.jsx`)
        *   Stats: (`src/pages/Stats.jsx`)
        *   GooeyNav: (`src/pages/GooeyNav.jsx`)
    *   ReactBits Components: Reusable UI components located in `src/components/reactbits/`.
        *   Aurora: (`src/components/reactbits/Aurora/Aurora.jsx`)
        *   SplitText: (`src/components/reactbits/SplitText/SplitText.jsx`)
        *   SpotlightCard: (`src/components/reactbits/SpotlightCard/SpotlightCard.jsx`)
		*   CountUp: (`src/components/reactbits/CountUp/CountUp.jsx`)
        *   ScrollVelocity: (`src/components/reactbits/ScrollVelocity/ScrollVelocity.jsx`)
        *   TiltedCard: (`src/components/TiltedCard/TiltedCard.jsx`)
        *   Particles: (`src/components/reactbits/Particles/Particles.jsx`)
        *   Folder: (`src/components/reactbits/Folder/Folder.jsx`)
		*   TextType:  (`src/components/reactbits/TextType/TextType.jsx`)
		*   Squares: (`src/components/reactbits/Squares/Squares.jsx`)
		*   ScrollStack: (`src/components/ScrollStack/ScrollStack.jsx`)
		*   StaggeredMenu: (`src/components/StaggeredMenu/StaggeredMenu.jsx`)
        *   ChromaGrid: (`src/components/ChromaGrid/ChromaGrid.jsx`)
		*   ShinyText: (`src/components/reactbits/ShinyText/ShinyText.jsx`)
		*   Magnet: (`src/components/reactbits/Magnet/Magnet.Magnet.jsx`)
		*   GradientText: (`src/components/GradientText/GradientText.jsx`)
		*   RotatingText: (`src/components/RotatingText/RotatingText.jsx`)
		*   ShuffleText: (`src/components/reactbits/ShuffleText/ShuffleText.ShuffleText.jsx`)
		*   PillNav: (`src/components/reactbits/PillNav/PillNav.jsx`)
		*	GooeyNav: (`src/components/reactbits/GooeyNav/GooeyNav.jsx`)
    *   AI Service: A unified `aiAPI` (`Tu2tor/src/services/aiAPI.js`) that communicates with the backend AI service.

*   **Backend (`Tu2tor/server/src`):**
    *   **Framework:** Node.js with Express.
    *   **Database:** MongoDB (using Mongoose).
    *   **API Routes:**
        *   `/api/auth`: User authentication.
        *   `/api/tutors`: Tutor management and search.
        *   `/api/bookings`: Session scheduling.
        *   `/api/reviews`: Rating system.
        *   `/api/messages`: Messaging functionality
        *   `/api/notifications`: Notification management
        *   `/api/study-notes`: Study note management
        *   `/api/todos`: Todo management
        *   `/api/code/execute`: Sandbox for executing code (supports JavaScript and Python).
        *   `/api/ai/generate`: -  Content generation
        *   `/api/ai/chat`: -   Streaming chat (SSE)
        *   `/api/ai/detect-subject`: -  å­¦ç§‘æ£€æµ‹
        *   `/api/ai/generate-note`: -  ç”Ÿæˆç¬”è®°
        *   `/api/ai/providers`: -  è·å–å¯ç”¨ Provider
        *   `/api/ai/providers/switch`: -  åˆ‡æ¢ Provider
        *   `/api/ai/usage`: -  ä½¿ç”¨ç»Ÿè®¡
        *   `/api/ai/health`: -  å¥åº·æ£€æŸ¥
        *   `/api/knowledge-base`: - Knowledge base management
        *   `/api/knowledge-base/subject/:subjectId/stats`: - Subject Knowledge Base statistics
        *   `/api/knowledge-base/search`: - Knowledge Base Search
        *   `/api/knowledge-base/tags`: - Knowledge Base tags
	    *   `/api/knowledge-base/:id/content` - è·å–æå–çš„æ–‡æœ¬å†…å®¹ï¼ˆæ”¯æŒ `?page=&pageSize=&includeFullText=`ï¼‰
        *   `/api/rag/query`: - RAG query
		*   `POST /api/bookings/:id/start` - API endpoint
   		*   `POST /api/bookings/:id/complete` - API endpoint

### Session Completion Logic Optimization
- The Session completion is now optimized. The upcoming session will not be marked as completed when the video is exited. It should be marked by the user or it will be marked as completed automatically after 2 hours.

### Markdown åä½œç¼–è¾‘å™¨åŠŸèƒ½

#### **æ–°å¢ç»„ä»¶**

1. **MarkdownCollabEditor** (`Tu2tor/src/components/session/MarkdownCollabEditor.jsx`)

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ğŸ“ **å®æ—¶åä½œç¼–è¾‘**ï¼šä½¿ç”¨ Yjs + WebSocket å®ç°å¤šäººåŒæ­¥ç¼–è¾‘
- ğŸ‘¥ **ç”¨æˆ·æ„ŸçŸ¥**ï¼šæ˜¾ç¤ºæ‰€æœ‰åœ¨çº¿åä½œè€…ï¼Œå¸¦é¢œè‰²æ ‡è¯†
- ğŸ”„ **ä¸‰ç§æ¨¡å¼**ï¼š
  - **Edit**: çº¯ç¼–è¾‘æ¨¡å¼
  - **Split**: å·¦å³åˆ†å±ï¼ˆç¼–è¾‘+é¢„è§ˆï¼‰
  - **Preview**: çº¯é¢„è§ˆæ¨¡å¼

**Markdown æ¸²æŸ“**ï¼š
- âœ… ä»£ç å—è¯­æ³•é«˜äº®ï¼ˆæ·±è‰²ä¸»é¢˜ï¼‰
- âœ… æ ‡é¢˜å±‚çº§æ ·å¼
- âœ… åˆ—è¡¨ã€å¼•ç”¨å—
- âœ… 	é“¾æ¥ã€ç²—ä½“ã€æ–œä½“
- âœ… æ°´å¹³åˆ†éš”çº¿

**å·¥å…·æ åŠŸèƒ½**ï¼š
- ğŸ’¾ **Save**: ä¿å­˜åˆ° localStorageï¼ˆå¯æ‰©å±•åˆ°åç«¯ï¼‰
- ğŸ“¥ **Download**: å¯¼å‡ºä¸º `.md` æ–‡ä»¶
- ğŸ‘¥ **User Count**: æ˜¾ç¤ºåœ¨çº¿åä½œè€…æ•°é‡

#### 2. **NoteSelector** (`Tu2tor/src/components/session/NoteSelector.jsx`)

**åŠŸèƒ½**ï¼š
- ğŸ“š **æµè§ˆæ‰€æœ‰ç¬”è®°**ï¼šä» Study Notes åŠ è½½
- ğŸ” **æœç´¢åŠŸèƒ½**ï¼šæŒ‰æ ‡é¢˜å’Œå†…å®¹æœç´¢
- ğŸ·ï¸ **å­¦ç§‘ç­›é€‰**ï¼šæŒ‰å­¦ç§‘å¿«é€Ÿè¿‡æ»¤
- â• **åˆ›å»ºæ–°ç¬”è®°**ï¼šå¿«é€Ÿåˆ›å»ºåä½œç¬”è®°
- ğŸ¨ **ç²¾ç¾å¡ç‰‡**ï¼šæ˜¾ç¤ºç¬”è®°æ‘˜è¦ã€æ ‡ç­¾ã€æ—¥æœŸ

### ğŸ® **Session Room UI æ›´æ–°**

#### **æ–°å¢æŒ‰é’®**ï¼ˆè§†é¢‘çª—å£å³ä¸Šè§’ï¼‰ï¼š

1. **Code Editor** æŒ‰é’®ï¼ˆè“è‰² `<Code2>` å›¾æ ‡ï¼‰ï¼š
   - æ‰“å¼€/å…³é—­ä»£ç ç¼–è¾‘å™¨
   - æ”¯æŒ Python æ²™ç®±

2. **Markdown Editor** æŒ‰é’®ï¼ˆç´«è‰² `<FileText>` å›¾æ ‡ï¼‰ï¼š
   - é¦–æ¬¡ç‚¹å‡»ï¼šæ‰“å¼€ç¬”è®°é€‰æ‹©å™¨
   - å·²é€‰ç¬”è®°ï¼šæ‰“å¼€/å…³é—­ Markdown ç¼–è¾‘å™¨
   - æ´»è·ƒæ—¶é«˜äº®æ˜¾ç¤º

3. **Minimize** å’Œ **Fullscreen** æŒ‰é’®ï¼š
   - æœ€å°åŒ–åˆ°æµ®åŠ¨çª—å£
   - å…¨å±æ¨¡å¼

#### **æ™ºèƒ½åˆ‡æ¢**ï¼š
- Code å’Œ Markdown ç¼–è¾‘å™¨äº’æ–¥
- åˆ‡æ¢æ—¶è‡ªåŠ¨å…³é—­å¦ä¸€ä¸ªç¼–è¾‘å™¨
- è§†é¢‘çª—å£è‡ªåŠ¨è°ƒæ•´å¤§å°ï¼ˆ50% æˆ– 100%ï¼‰

### ğŸ“‹ **ä½¿ç”¨æµç¨‹**

#### **æ‰“å¼€å·²ä¿å­˜çš„ç¬”è®°**ï¼š
```
1. åŠ å…¥ Session
2. ç‚¹å‡»ç´«è‰² FileText å›¾æ ‡
3. åœ¨å¼¹çª—ä¸­æœç´¢/æµè§ˆç¬”è®°
4. ç‚¹å‡»ç¬”è®°å¡ç‰‡æ‰“å¼€
5. åŒæ–¹å®æ—¶åä½œç¼–è¾‘
```

#### **åˆ›å»ºæ–°ç¬”è®°**ï¼š
```
1. ç‚¹å‡»ç´«è‰² FileText å›¾æ ‡
2. ç‚¹å‡» "Create New Collaborative Note"
3. å¼€å§‹ç¼–å†™
4. è‡ªåŠ¨åŒæ­¥ç»™å¯¹æ–¹
```

#### **åˆ‡æ¢ç¼–è¾‘å™¨**ï¼š
```
- Code â†” Markdown: è‡ªåŠ¨åˆ‡æ¢
- è§†é¢‘çª—å£è‡ªåŠ¨è°ƒæ•´
- ä¿æŒä¼šè®®è¿æ¥
```

### ğŸ”„ **å®æ—¶åä½œç‰¹æ€§**

- âœ… **å¤šäººåŒæ­¥**ï¼šæ‰€æœ‰ç¼–è¾‘å®æ—¶åŒæ­¥
- âœ… **å†²çªè§£å†³**ï¼šYjs CRDT ç®—æ³•ä¿è¯ä¸€è‡´æ€§
- âœ… **ç”¨æˆ·æ ‡è¯†**ï¼šæ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç‰¹é¢œè‰²
- âœ… **åœ¨çº¿çŠ¶æ€**ï¼šæ˜¾ç¤ºæ‰€æœ‰åœ¨çº¿åä½œè€…
- âœ… **æ–­çº¿é‡è¿**ï¼šWebSocket è‡ªåŠ¨é‡è¿

### ğŸ¨ **UI è®¾è®¡**

#### **Markdown ç¼–è¾‘å™¨æ ·å¼**ï¼š
- æ·±è‰²ä¸»é¢˜ï¼ˆä¸ Code Editor ä¸€è‡´ï¼‰
- ç´«è‰²ä¸»é¢˜è‰²ï¼ˆåŒºåˆ«äºä»£ç ç¼–è¾‘å™¨çš„è“è‰²ï¼‰
- ä¸“ä¸šçš„ Markdown æ¸²æŸ“
- æµç•…çš„æ¨¡å¼åˆ‡æ¢åŠ¨ç”»

#### **ç¬”è®°é€‰æ‹©å™¨æ ·å¼**ï¼š
- æ¨¡æ€å¯¹è¯æ¡†è®¾è®¡
- å“åº”å¼ç½‘æ ¼å¸ƒå±€
- æ‚¬åœåŠ¨ç”»æ•ˆæœ
- æ¸…æ™°çš„è§†è§‰å±‚æ¬¡

### ğŸ’¡ **ä½¿ç”¨åœºæ™¯**

1. **å¤ä¹ ç¬”è®°**ï¼š
   - æ‰“å¼€ä¹‹å‰ä¿å­˜çš„å­¦ä¹ ç¬”è®°
   - å¯¼å¸ˆå’Œå­¦ç”Ÿä¸€èµ·å›é¡¾
   - å®æ—¶æ·»åŠ æ³¨é‡Šå’Œè¡¥å……

2. **åä½œè®°å½•**ï¼š
   - ä¼šè®®ä¸­åˆ›å»ºæ–°ç¬”è®°
   - åŒæ–¹å…±åŒè®°å½•è¦ç‚¹
   - ä¿å­˜ä¸ºå­¦ä¹ ææ–™

3. **ä»£ç æ³¨é‡Š**ï¼š
   - åœ¨ Markdown ä¸­è§£é‡Šä»£ç 
   - æ·»åŠ ä»£ç å—ç¤ºä¾‹
   - æ ¼å¼åŒ–çš„æŠ€æœ¯æ–‡æ¡£

### ğŸ”’ **æŠ€æœ¯äº®ç‚¹**

- âœ… Yjs CRDT ç®—æ³•ä¿è¯ä¸€è‡´æ€§
- âœ… WebSocket å®æ—¶é€šä¿¡
- âœ… React Markdown æ¸²æŸ“
- âœ… Framer Motion åŠ¨ç”»
- âœ… å“åº”å¼è®¾è®¡
- âœ… é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

ç°åœ¨ä½ çš„ Session Room æ‹¥æœ‰äº†å®Œæ•´çš„åä½œå·¥å…·å¥—ä»¶ï¼š
- ğŸ¥ è§†é¢‘ä¼šè®®
- ğŸ’» ä»£ç ç¼–è¾‘å™¨ï¼ˆå¸¦ Python æ²™ç®±ï¼‰
- ğŸ“ Markdown ç¼–è¾‘å™¨ï¼ˆå®æ—¶åä½œï¼‰

å®Œç¾çš„åœ¨çº¿è¾…å¯¼ä½“éªŒï¼ğŸ‰

### Session Room UI Layout Rules:
1. When in code or markdown mode, the video should play in a smaller window.
2. Code and Markdown editors can be launched together, enabling a split-screen view.

### upcoming session should not be marked as completed when the video is exited
- The upcoming session will not be marked as completed when the video is exited. It should be marked by the user or it will be marked as completed automatically after 2 hours.

### AI Chat Rules:
1. The AI title should use the https://reactbits.dev/text-animations/rotating-text style

2. The three buttons on the top bar should use the https://reactbits.dev/components/pill-nav style with a black and white tone

3. Video should be minimized when code or markdown mode are active.
4. The information below the video call in the Session page should be displayed with the correct information

### todoController.js Fix
- Todo API calls now use req.user._id instead of req.user.userId

### JitsiMeetRoom.jsx Fix
-  Unnecessary JSON.stringify call removed from JitsiMeetRoom.jsx

### AIChat.jsx - UI
- The "Online & Ready to Help" line should be removed
- The text "AI Tu2tor" should use Shuffle

### Session Info - Below video
The information below the video call in the Session page should be displayed with the correct information

### AI Model Selection Strategy (Backend)
1. Prioritize specific models for image analysis and deep thinking tasks.
2. Ensure that the backend can gracefully handle cases where a requested model is unavailable, falling back to a default model or providing an informative error message.

### todoController.js User ID Inconsistency Fix:
- The todoController.js now correctly uses req.user._id to access the user ID, ensuring that todo queries function as expected.

### JitsiMeetRoom.jsx displayName Formatting:
- The JitsiMeetRoom.jsx component no longer wraps the displayName value in JSON.stringify() before URL encoding, ensuring that the display name is received as a plain string.

### Session Completion Logic Optimization
- The Session completion is now optimized. The upcoming session will not be marked as completed when the video is exited. It should be marked by the user or it will be marked as completed automatically after 2 hours.

### The Gemini Model Configuration
Use the following models in GeminiProvider.js:
1.  GEMINI_MODEL=gemini-2.5-flash                # æ™®é€šå¯¹è¯æ¨¡å¼
2.  GEMINI_THINKING_MODEL=gemini-3-pro-preview   # æ·±åº¦æ€è€ƒæ¨¡å¼

### è‡ªåŠ¨åˆ‡æ¢å¤šæ¨¡æ€æ¨¡å‹åŠŸèƒ½
- When in deep thinking mode and images are present, the system automatically switches to a vision-enabled Gemini model

### Current .env Configuration:
1.  GEMINI_MODEL=gemini-2.5-flash
2.  GEMINI_THINKING_MODEL=gemini-2.5-pro
3.  GEMINI_VISION_MODEL=gemini-2.5-flash

### Code Modifications:
1.  Modified the code to enable the use of the prescribed models based on the functionality in use (Deep Think vs General Q&A).

### Action items
- Add rate limiting to the backend
- Add cost tracking to the backend
- Front-end: Re-implement provider selection using the new backend API
- Front-end: Remove AI API keys from .env.local
- Front-end: Remove AI-related code that is no longer needed

### ğŸ¨ Markdown editor UI
- The deep theme should be followed
- The primary color is purple

### UI Update

1. The AI title should use the https://reactbits.dev/text-animations/rotating-text style

2. The three buttons on the top bar should use the https://reactbits.dev/components/pill-nav style with a black and white tone

### AIChat.jsx - UI
- The "Online & Ready to Help" line should be removed
- The text "AI Tu2tor" should use Shuffle

### In AI Chat
- the deepthink moved to the conversation area
- Add import notes in the upper bar

### ğŸ¨ UI æ”¹è¿›
1.  é¡¶éƒ¨å·¥å…·æ é¢œè‰²
2.  æ·»åŠ äº†è¿æ¥ç”¨æˆ·æ•°æ˜¾ç¤º
3.  Markdownç¼–è¾‘å™¨æ ·å¼æ”¹è¿›
4.  ä»£ç ç¼–è¾‘å™¨æ ·å¼æ”¹è¿›
5.  é¢„è§ˆåŒºåŸŸæ ·å¼æ”¹è¿›

### 413 Payload Too Large error
- To fix the 413 Payload Too Large error, the Express body size limit has been increased to 10MB.
- The following code has been added:
```javascript
app.use(express.json({ limit: '10mb' });
app.use(express.urlencoded({ extended: true, limit: '10mb' }));
```

### åç«¯ API

1.  æ–°å¢API ç«¯ç‚¹
    -   POST /api/bookings/:id/start
    -   POST /api/bookings/:id/complete

### todoController.js ä¿®æ­£
1.  æ›´æ–°äº†æ§åˆ¶å™¨ä»¥ä½¿ç”¨req.user._id

### New Rule - AI Knowledge Base
1. Simplify plan to focus on OCR and text extraction.
2. Prioritize backend stability and data management, deferring complex AI integrations to future phases.
3. Implement a straightforward upload process with file type validation.
4. Ensure robust error handling and clear feedback mechanisms for file processing.
5. Begin with a file size limit of 50MB.
6. Focus on extracting data from PDF, PPTX, DOCX, and image formats.
- If there are any issues with the current model, I should use gemini-2.0-flash

### AI Knowledge Base .env
1. Add KB_MAX_CONCURRENT to .env

### AI Recommendation update
-  The AI recommendations is now based on ratings and expertise

### New Model Configuration
Use the following models in GeminiProvider.js:
1.  GEMINI_MODEL=gemini-2.5-flash # æ™®é€šå¯¹è¯æ¨¡å¼
2.  GEMINI_THINKING_MODEL=gemini-2.5-pro # æ·±åº¦æ€è€ƒæ¨¡å¼

### AI ç°åœ¨å¯ä»¥è®¿é—® Gemini æ¨¡å‹ç«¯ç‚¹
1.  æ¨¡å‹ç«¯ç‚¹ä¸ºï¼š
    -   gemini-2.5-flash
    -   gemini-3-pro-preview

### In test-ai-simple.js
1.  ç°åœ¨æµ‹è¯•é…ç½®ä¸ºæ­£ç¡®çš„ Gemini æ¨¡å‹

### Current .env é…ç½®
1.  The current .env config includes:
    -   frontend: Tu2tor/.env.local
    -   backend: Tu2tor/server/.env

### In AIRecommendations.jsx
1.  If I find that there are errors stemming from AIRecommendations.jsx I must make the following changes:
    -   Change the import statement to use the aiAPI
    -   Remove the AI service object
    -   Ensure that the code still functions correctly
    -   Remove the keyword detection

### In AIChat.jsx
1.  Must remove the aiService parameter from "detectAcademicSubject"

###  In src/utils/studyNoteHelper.js
1.  Must remove the aiService parameter

### Important notes
1.  For now it's ok to just finish the backend AI migration and leave all the frontend changes for later

### If I find that the API Key is invalid
1.  I should have the user create a new API key and use that instead

### GeminiProvider.js
1.  I must ensure that streamChat is set up as an async generator

### If I can't access the .env file
1.  I can use the following PowerShell script to get the contents

### About the project
1.  The project name is Tu2tor
2.  It's a full stack application
3.  The stack is MERN
4.  The project is a peer to peer tutoring application

### Current AI service
1.  The current AI service that is configured is Gemini

### If the tests are still failing
1.  I should try to use older versions of the model
2.  I should try to make the prompt less complex

### Test all endpoints
1.  Make sure that the following endpoints are tested
 - /api/ai/chat
 - /api/ai/generate
 - /api/ai/detect-subject
 - /api/ai/generate-note

### In the event of Power Shell errors
1.  If I get a Power Shell error I should try another way to run the command
2.  Power Shell does not support && syntax

### AiMigrationPlan
1.  The AiMigrationPlan is a detailed plan to migrate the AI service to the backend
2.  It goes over steps to migrate the AI service to the backend in 8 phases

### About AiService
1.  There are 3 providers
 - Gemini
 - OpenAi
 - Ollama

### åœ¨ GeminiProvider.js ä¸­ä½¿ç”¨ä»¥ä¸‹æ¨¡å‹ï¼š
1.  GEMINI_MODEL=gemini-2.5-flash # æ™®é€šå¯¹è¯æ¨¡å¼
2.  GEMINI_THINKING_MODEL=gemini-3-pro-preview # æ·±åº¦æ€è€ƒæ¨¡å¼

### ğŸ¨ AIçŸ¥è¯†åº“ç³»ç»Ÿ - ä¸»è¦è®¾è®¡å†³ç­–
1.  æ ¸å¿ƒåŠŸèƒ½ï¼šæ–‡æ¡£ä¸Šä¼  (PDF, PPTX, å›¾ç‰‡) + OCR è¯†åˆ« + å…³é”®è¯æ£€ç´¢ + AI å¢å¼ºã€‚
2.  æŠ€æœ¯é€‰å‹ï¼š
    - æ•°æ®åº“ï¼šMongoDB (æ— éœ€é¢å¤–å‘é‡æ•°æ®åº“)ã€‚
    - æ–‡æœ¬æå–ï¼špdf-parse, mammoth, officeparser, tesseract.jsã€‚
    - AIï¼šGemini 2.5 Pro (ç†è§£åŠ›å¼ºï¼Œå¼¥è¡¥å…³é”®è¯æ£€ç´¢ä¸è¶³)ã€‚
3.  APIè®¾è®¡ï¼šPOST /api/rag/queryï¼Œè¿”å›ç­”æ¡ˆå’Œèµ„æ–™æ¥æºã€‚
4.  UIè®¾è®¡ï¼šçŸ¥è¯†åº“æ¨¡å¼åˆ‡æ¢ï¼Œå±•ç¤ºç›¸å…³æ–‡æ¡£ï¼ŒæŸ¥çœ‹è¯¦ç»†å†…å®¹ã€‚

### ğŸ¨ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
1.  æµ·é‡æ•°æ®ï¼šMongoDB ç´¢å¼•å’Œåˆ†ç‰‡ã€‚
2.  é«˜å¹¶å‘ï¼šNode.js å¼‚æ­¥å¤„ç† + è¿æ¥æ± ã€‚
3.  å¤æ‚ OCRï¼šGPU åŠ é€Ÿ + ç¦»çº¿å¤„ç†ã€‚

### ğŸ¨ å®‰å…¨è®¾è®¡
1.  æ‰€æœ‰ API å¿…é¡»é€šè¿‡ JWT è®¤è¯ã€‚
2.  è®¿é—®æ§åˆ¶ï¼šæ‰€æœ‰ API å¿…é¡»é€šè¿‡ JWT è®¤è¯ã€‚
3.  è¾“å…¥æ ¡éªŒï¼šæ‰€æœ‰è¾“å…¥å¿…é¡»ç»è¿‡ä¸¥æ ¼æ ¡éªŒã€‚

### å‰ç«¯æ–‡ä»¶ç±»å‹

1. å¦‚æœæ–‡ä»¶ç±»å‹æ— æ³•è¯†åˆ«ï¼Œæˆ‘å¿…é¡»ä½¿ç”¨ req.file.mimetypeã€‚

### å‰ç«¯ 413 é”™è¯¯

1.  è¦ä¿®å¤ 413 Payload Too Large é”™è¯¯ï¼ŒExpress body size limit å·²å¢åŠ åˆ° 10MBã€‚
2.  æ·»åŠ äº†ä»¥ä¸‹ä»£ç ï¼š
    ```javascript
    app.use(express.json({ limit: '10mb' });
    app.use(express.urlencoded({ extended: true, limit: '10mb' }));
    ```

### åç«¯é”™è¯¯ä¿®å¤

1.  åç«¯é”™è¯¯å“åº” must include 'success: false'ã€‚

### æ¨¡å‹é€‰æ‹©è§„åˆ™
1.  The selection of models should only consider user selection on deepthink
2.  I must use req.file.mimetype

### In src/services/api.js
1.  æ–°å¢äº†çŸ¥è¯†åº“æ¥å£ï¼šknowledgeBaseAPI.list å’Œ ragAPI.query

### åœ¨ AIChat.jsx ä¸­
1.  å®ç°äº†çŸ¥è¯†åº“æ¨¡å¼ï¼ˆRAGï¼‰
2.  æ·»åŠ äº†å‹¾é€‰æ–‡æ¡£

### åœ¨ SessionRoomPage.jsx ä¸­
1.  æ·»åŠ äº†çŸ¥è¯†åº“é¢æ¿
2.  The addition of toggleKBSelection to allow for the selection of various knowledge base documents.

### åç«¯
1.  ä½¿ç”¨äº† MongoDB å…¨æ–‡æœç´¢ + Gemini AI æ¥å®ç° RAG
2.  éœ€è¦æ·»åŠ  req.user åˆ° query

### In AIChat.jsx
1. The handleSendMessage function must be updated to display the proper data

### In GeminiProvider.js
1.  I must ensure that streamChat is set up as an async generator

### In the event of errors
1.  If I encounter errors I must check the backend logs

### In test-knowledge-base.js
1.  If I find that the test is not working, I must check the API key for authentication
2.  I must make sure that the following keys are set
    - userId
    - subjectId
    - title
    - description
    - tags
    - visibility

### The proper location to check the .env file
1. frontend: Tu2tor/.env.local
2. backend: Tu2tor/server/.env

### About the project
1.  The project name is Tu2tor
2.  It's a full stack application
3.  The stack is MERN
4.  The project is a peer to peer tutoring application

### Current AI service
1.  The current AI service that is configured is Gemini

### If the tests are still failing
1.  I should try to use older versions of the model
2.  I should try to make the prompt less complex

### Test all endpoints
1.  Make sure that the following endpoints are tested
 - /api/ai/chat
 - /api/ai/generate
 - /api/ai/detect-subject
 - /api/ai/generate-note

### In the event of Power Shell errors
1.  If I get a Power Shell error I should try another way to run the command
2.  Power Shell does not support && syntax

### AiMigrationPlan
1.  The AiMigrationPlan is a detailed plan to migrate the AI service to the backend
2.  It goes over steps to migrate the AI service to the backend in 8 phases

### About AiService
1.  There are 3 providers
 - Gemini
 - OpenAi
 - Ollama

### åœ¨ GeminiProvider.js ä¸­ä½¿ç”¨ä»¥ä¸‹æ¨¡å‹ï¼š
1.  GEMINI_MODEL=gemini-2.5-flash # æ™®é€šå¯¹è¯æ¨¡å¼
2.  GEMINI_THINKING_MODEL=gemini-3-pro-preview # æ·±åº¦æ€è€ƒæ¨¡å¼

### ğŸ¨ AIçŸ¥è¯†åº“ç³»ç»Ÿ - ä¸»è¦è®¾è®¡å†³ç­–
1.  æ ¸å¿ƒåŠŸèƒ½ï¼šæ–‡æ¡£ä¸Šä¼  (PDF, PPTX, å›¾ç‰‡) + OCR è¯†åˆ« + å…³é”®è¯æ£€ç´¢ + AI å¢å¼ºã€‚
2.  æŠ€æœ¯é€‰å‹ï¼š
    - æ•°æ®åº“ï¼šMongoDB (æ— éœ€é¢å¤–å‘é‡æ•°æ®åº“)ã€‚
    - æ–‡æœ¬æå–ï¼špdf-parse, mammoth, officeparser, tesseract.jsã€‚
    - AIï¼šGemini 2.5 Pro (ç†è§£åŠ›å¼ºï¼Œå¼¥è¡¥å…³é”®è¯æ£€ç´¢ä¸è¶³)ã€‚
3.  APIè®¾è®¡ï¼šPOST /api/rag/queryï¼Œè¿”å›ç­”æ¡ˆå’Œèµ„æ–™æ¥æºã€‚
4.  UIè®¾è®¡ï¼šçŸ¥è¯†åº“æ¨¡å¼åˆ‡æ¢ï¼Œå±•ç¤ºç›¸å…³æ–‡æ¡£ï¼ŒæŸ¥çœ‹è¯¦ç»†å†…å®¹ã€‚

### ğŸ¨ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
1.  æµ·é‡æ•°æ®ï¼šMongoDB ç´¢å¼•å’Œåˆ†ç‰‡ã€‚
2.  é«˜å¹¶å‘ï¼šNode.js å¼‚æ­¥å¤„ç† + è¿æ¥æ± ã€‚
3.  å¤æ‚ OCRï¼šGPU åŠ é€Ÿ + ç¦»çº¿å¤„ç†ã€‚

### ğŸ¨ å®‰å…¨è®¾è®¡
1.  æ‰€æœ‰ API å¿…é¡»é€šè¿‡ JWT è®¤è¯ã€‚
2.  è®¿é—®æ§åˆ¶ï¼šæ‰€æœ‰ API å¿…é¡»é€šè¿‡ JWT è®¤è¯ã€‚
3.  è¾“å…¥æ ¡éªŒï¼šæ‰€æœ‰è¾“å…¥å¿…é¡»ç»è¿‡ä¸¥æ ¼æ ¡éªŒã€‚

### å‰ç«¯æ–‡ä»¶ç±»å‹

1. å¦‚æœæ–‡ä»¶ç±»å‹æ— æ³•è¯†åˆ«ï¼Œæˆ‘å¿…é¡»ä½¿ç”¨ req.file.mimetypeã€‚

### å‰ç«¯ 413 é”™è¯¯

1.  è¦ä¿®å¤ 413 Payload Too Large é”™è¯¯ï¼ŒExpress body size limit å·²å¢åŠ åˆ° 10MBã€‚
2.  æ·»åŠ äº†ä»¥ä¸‹ä»£ç ï¼š
    ```javascript
    app.use(express.json({ limit: '10mb' });
    app.use(express.urlencoded({ extended: true, limit: '10mb' }));
    ```

### åç«¯é”™è¯¯ä¿®å¤

1.  åç«¯é”™è¯¯å“åº” must include 'success: false'ã€‚

### æ¨¡å‹é€‰æ‹©è§„åˆ™
1.  The selection of models should only consider user selection on deepthink
2.  I must use req.file.mimetype

### In src/services/api.js
1.  æ–°å¢äº†çŸ¥è¯†åº“æ¥å£ï¼šknowledgeBaseAPI.list å’Œ ragAPI.query

### åœ¨ AIChat.jsx ä¸­
1.  å®ç°äº†çŸ¥è¯†åº“æ¨¡å¼ï¼ˆRAGï¼‰
2.  æ·»åŠ äº†å‹¾é€‰æ–‡æ¡£

### åœ¨ SessionRoomPage.jsx ä¸­
1.  æ·»åŠ äº†çŸ¥è¯†åº“é¢æ¿
2.  The addition of toggleKBSelection to allow for the selection of various knowledge base documents.

### åç«¯
1.  ä½¿ç”¨äº† MongoDB å…¨æ–‡æœç´¢ + Gemini AI æ¥å®ç° RAG
2.  éœ€è¦æ·»åŠ  req.user åˆ° query

### In AIChat.jsx
1. The handleSendMessage function must be updated to display the proper data

### In GeminiProvider.js
1.  I must ensure that streamChat is set up as an async generator

### In the event of errors
1.  If I encounter errors I must check the backend logs

### In test-knowledge-base.js
1.  If I find that the test is not working, I must check the API key for authentication
2.  I must make sure that the following keys are set
    - userId
    - subjectId
    - title
    - description
    - tags
    - visibility

### The proper location to check the .env file
1. frontend: Tu2tor/.env.local
2. backend: Tu2tor/server/.env

### About the project
1.  The project name is Tu2tor
2.  It's a full stack application
3.  The stack is MERN
4.  The project is a peer to peer tutoring application

### Current AI service
1.  The current AI service that is configured is Gemini

### If the tests are still failing
1.  I should try to use older versions of the model
2.  I should try to make the prompt less complex

### Test all endpoints
1.  Make sure that the following endpoints are tested
 - /api/ai/chat
 - /api/ai/generate
 - /api/ai/detect-subject
 - /api/ai/generate-note

### In the event of Power Shell errors
1.  If I get a Power Shell error I should try another way to run the command
2.  Power Shell does not support && syntax

### AiMigrationPlan
1.  The AiMigrationPlan is a detailed plan to migrate the AI service to the backend
2.  It goes over steps to migrate the AI service to the backend in 8 phases

### About AiService
1.  There are 3 providers
 - Gemini
 - OpenAi
 - Ollama

### åœ¨ GeminiProvider.js ä¸­ä½¿ç”¨ä»¥ä¸‹æ¨¡å‹ï¼š
1.  GEMINI_MODEL=gemini-2.5-flash # æ™®é€šå¯¹è¯æ¨¡å¼
2.  GEMINI_THINKING_MODEL=gemini-3-pro-preview # æ·±åº¦æ€è€ƒæ¨¡å¼

### ğŸ¨ AIçŸ¥è¯†åº“ç³»ç»Ÿ - ä¸»è¦è®¾è®¡å†³ç­–
1.  æ ¸å¿ƒåŠŸèƒ½ï¼šæ–‡æ¡£ä¸Šä¼  (PDF, PPTX, å›¾ç‰‡) + OCR è¯†åˆ« + å…³é”®è¯æ£€ç´¢ + AI å¢å¼ºã€‚
2.  æŠ€æœ¯é€‰å‹ï¼š
    - æ•°æ®åº“ï¼šMongoDB (æ— éœ€é¢å¤–å‘é‡æ•°æ®åº“)ã€‚
    - æ–‡æœ¬æå–ï¼špdf-parse, mammoth, officeparser, tesseract.jsã€‚
    - AIï¼šGemini 2.5 Pro (ç†è§£åŠ›å¼ºï¼Œå¼¥è¡¥å…³é”®è¯æ£€ç´¢ä¸è¶³)ã€‚
3.  APIè®¾è®¡ï¼šPOST /api/rag/queryï¼Œè¿”å›ç­”æ¡ˆå’Œèµ„æ–™æ¥æºã€‚
4.  UIè®¾è®¡ï¼šçŸ¥è¯†åº“æ¨¡å¼åˆ‡æ¢ï¼Œå±•ç¤ºç›¸å…³æ–‡æ¡£ï¼ŒæŸ¥çœ‹è¯¦ç»†å†…å®¹ã€‚

### ğŸ¨ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
1.  æµ·é‡æ•°æ®ï¼šMongoDB ç´¢å¼•å’Œåˆ†ç‰‡ã€‚
2.  é«˜å¹¶å‘ï¼šNode.js å¼‚æ­¥å¤„ç† + è¿æ¥æ± ã€‚
3.  å¤æ‚ OCRï¼šGPU åŠ é€Ÿ + ç¦»çº¿å¤„ç†ã€‚

### ğŸ¨ å®‰å…¨è®¾è®¡
1.  æ‰€æœ‰ API å¿…é¡»é€šè¿‡ JWT è®¤è¯ã€‚
2.  è®¿é—®æ§åˆ¶ï¼šæ‰€æœ‰ API å¿…é¡»é€šè¿‡ JWT è®¤è¯ã€‚
3.  è¾“å…¥æ ¡éªŒï¼šæ‰€æœ‰è¾“å…¥å¿…é¡»ç»è¿‡ä¸¥æ ¼æ ¡éªŒã€‚

### å‰ç«¯æ–‡ä»¶ç±»å‹

1. å¦‚æœæ–‡ä»¶ç±»å‹æ— æ³•è¯†åˆ«ï¼Œæˆ‘å¿…é¡»ä½¿ç”¨ req.file.mimetypeã€‚

### å‰ç«¯ 413 é”™è¯¯

1.  è¦ä¿®å¤ 413 Payload Too Large é”™è¯¯ï¼ŒExpress body size limit å·²å¢åŠ åˆ° 10MBã€‚
2.  æ·»åŠ äº†ä»¥ä¸‹ä»£ç ï¼š
    ```javascript
    app.use(express.json({ limit: '10mb' });
    app.use(express.urlencoded({ extended: true, limit: '10mb' }));
    ```

### åç«¯é”™è¯¯ä¿®å¤

1.  åç«¯é”™è¯¯å“åº” must include 'success: false'ã€‚

### æ¨¡å‹é€‰æ‹©è§„åˆ™
1.  The selection of models should only consider user selection on deepthink
2.  I must use req.file.mimetype

### In src/services/api.js
1.  æ–°å¢äº†çŸ¥è¯†åº“æ¥å£ï¼šknowledgeBaseAPI.list å’Œ ragAPI.query

### åœ¨ AIChat.jsx ä¸­
1.  å®ç°äº†çŸ¥è¯†åº“æ¨¡å¼ï¼ˆRAGï¼‰
2.  æ·»åŠ äº†å‹¾é€‰æ–‡æ¡£

### åœ¨ SessionRoomPage.jsx ä¸­
1.  æ·»åŠ äº†çŸ¥è¯†åº“é¢æ¿
2.  The addition of toggleKBSelection to allow for the selection of various knowledge base documents.

### åç«¯
1.  ä½¿ç”¨äº† MongoDB å…¨æ–‡æœç´¢ + Gemini AI æ¥å®ç° RAG
2.  éœ€è¦æ·»åŠ  req.user åˆ° query

### In AIChat.jsx
1. The handleSendMessage function must be updated to display the proper data

### In GeminiProvider.js
1.  I must ensure that streamChat is set up as an async generator

### In the event of errors
1.  If I encounter errors I must check the backend logs

### In test-knowledge-base.js
1.  If I find that the test is not working, I must check the API key for authentication
2.  I must make sure that the following keys are set
    - userId
    - subjectId
    - title
    - description
    - tags
    - visibility

### The proper location to check the .env file
1. frontend: Tu2tor/.env.local
2. backend: Tu2tor/server/.env

### About the project
1.  The project name is Tu2tor
2.  It's a full stack application
3.  The stack is MERN
4.  The project is a peer to peer tutoring application

### Current AI service
1.  The current AI service that is configured is Gemini

### If the tests are still failing
1.  I should try to use older versions of the model
2.  I should try to make the prompt less complex

### Test all endpoints
1.  Make sure that the following endpoints are tested
 - /api/ai/chat
 - /api/ai/generate
 - /api/ai/detect-subject
 - /api/ai/generate-note

### In the event of Power Shell errors
1.  If I get a Power Shell error I should try another way to run the command
2.  Power Shell does not support && syntax

### AiMigrationPlan
1.  The AiMigrationPlan is a detailed plan to migrate the AI service to the backend
2.  It goes over steps to migrate the AI service to the backend in 8 phases

### About AiService
1.  There are 3 providers
 - Gemini
 - OpenAi
 - Ollama

### åœ¨ GeminiProvider.js ä¸­ä½¿ç”¨ä»¥ä¸‹æ¨¡å‹ï¼š
1.  GEMINI_MODEL=gemini-2.5-flash # æ™®é€šå¯¹è¯æ¨¡å¼
2.  GEMINI_THINKING_MODEL=gemini-3-pro-preview # æ·±åº¦æ€è€ƒæ¨¡å¼

### ğŸ¨ AIçŸ¥è¯†åº“ç³»ç»Ÿ - ä¸»è¦è®¾è®¡å†³ç­–
1.  æ ¸å¿ƒåŠŸèƒ½ï¼šæ–‡æ¡£ä¸Šä¼  (PDF, PPTX, å›¾ç‰‡) + OCR è¯†åˆ« + å…³é”®è¯æ£€ç´¢ + AI å¢å¼ºã€‚
2.  æŠ€æœ¯é€‰å‹ï¼š
    - æ•°æ®åº“ï¼šMongoDB (æ— éœ€é¢å¤–å‘é‡æ•°æ®åº“)ã€‚
    - æ–‡æœ¬æå–ï¼špdf-parse, mammoth, officeparser, tesseract.jsã€‚
    - AIï¼šGemini 2.5 Pro (ç†è§£åŠ›å¼ºï¼Œå¼¥è¡¥å…³é”®è¯æ£€ç´¢ä¸è¶³)ã€‚
3.  APIè®¾è®¡ï¼šPOST /api/rag/queryï¼Œè¿”å›ç­”æ¡ˆå’Œèµ„æ–™æ¥æºã€‚
4.  UIè®¾è®¡ï¼šçŸ¥è¯†åº“æ¨¡å¼åˆ‡æ¢ï¼Œå±•ç¤ºç›¸å…³æ–‡æ¡£ï¼ŒæŸ¥çœ‹è¯¦ç»†å†…å®¹ã€‚

### ğŸ¨ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
1.  æµ·é‡æ•°æ®ï¼šMongoDB ç´¢å¼•å’Œåˆ†ç‰‡ã€‚
2.  é«˜å¹¶å‘ï¼šNode.js å¼‚æ­¥å¤„ç† + è¿æ¥æ± ã€‚
3.  å¤æ‚ OCRï¼šGPU åŠ é€Ÿ + ç¦»çº¿å¤„ç†ã€‚

### ğŸ¨ å®‰å…¨è®¾è®¡
1.  æ‰€æœ‰ API å¿…é¡»é€šè¿‡ JWT è®¤è¯ã€‚
2.  è®¿é—®æ§åˆ¶ï¼šæ‰€æœ‰ API å¿…é¡»é€šè¿‡ JWT è®¤è¯ã€‚
3.  è¾“å…¥æ ¡éªŒï¼šæ‰€æœ‰è¾“å…¥å¿…é¡»ç»è¿‡ä¸¥æ ¼æ ¡éªŒã€‚

### å‰ç«¯æ–‡ä»¶ç±»å‹

1. å¦‚æœæ–‡ä»¶ç±»å‹æ— æ³•è¯†åˆ«ï¼Œæˆ‘å¿…é¡»ä½¿ç”¨ req.file.mimetypeã€‚

### å‰ç«¯ 413 é”™è¯¯

1.  è¦ä¿®å¤ 413 Payload Too Large é”™è¯¯ï¼ŒExpress body size limit å·²å¢åŠ åˆ° 10MBã€‚
2.  æ·»åŠ äº†ä»¥ä¸‹ä»£ç ï¼š
    ```javascript
    app.use(express.json({ limit: '10mb' });
    app.use(express.urlencoded({ extended: true, limit: '10mb' }));
    ```

### åç«¯é”™è¯¯ä¿®å¤

1.  åç«¯é”™è¯¯å“åº” must include 'success: false'ã€‚

### æ¨¡å‹é€‰æ‹©è§„åˆ™
1.  The selection of models should only consider user selection on deepthink
2.  I must use req.file.mimetype

### In src/services/api.js
1